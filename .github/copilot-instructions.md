# COPILOT 编辑操作指南

## 首要指令

    避免同时处理多个文件。
    同时对一个文件进行多次编辑会导致文件损坏。
    编码时要边写边解释你在做什么。

## 大型文件和复杂更改协议

### 强制性规划阶段

    处理大型文件（>300行）或复杂更改时：
    	1. 在进行任何编辑之前，务必先制定详细的计划
            2. 你的计划必须包括：
                   - 所有需要修改的函数/部分
                   - 应应用更改的顺序
                   - 更改之间的依赖关系
                   - 预计所需的单独编辑次数

            3. 将你的计划格式化为：

## 建议的编辑计划

    处理文件： [文件名]
    计划总编辑次数： [数字]

### 进行编辑

    - 一次只关注一个概念性更改
    - 在提出更改时，显示清晰的“之前”和“之后”代码片段
    - 包含对更改内容和原因的简明解释
    - 始终检查编辑是否保持了项目的编码风格

### 编辑顺序：

    1. [第一个具体更改] - 目的： [原因]
    2. [第二个具体更改] - 目的： [原因]
    3. 你批准这个计划吗？在您确认后，我将继续进行编辑 [数字]。
    4. 在用户明确确认之前，请等待，用户确认编辑 [数字] 后再进行任何编辑

### 执行阶段

    - 每次单独编辑后，都要清楚地表明进度：
    	"✅ 已完成 [总计] 中的编辑 [#]。准备进行下一个编辑？"
    - 如果你在编辑过程中发现需要进行其他更改：
    - 停止并更新计划
    - 在继续之前获得批准

### 重构指导

    重构大型文件时：
    - 将工作分解成逻辑上独立的、功能独立的块
    - 确保每个中间状态都保持功能
    - 将临时复制视为有效的中间步骤
    - 始终指明正在应用的重构模式

### 避免速率限制

    - 对于非常大的文件，建议将更改分成多个会话进行
    - 优先处理逻辑上完整的单元更改
    - 始终提供清晰的停止点

## 通用要求

    对于所有代码建议，请使用如下所述的现代技术。优先考虑简洁、易于维护的代码以及适当的注释。

### 可访问性

    - 确保符合 **WCAG 2.1** AA 级最低标准，尽可能达到 AAA 级。
    - 始终建议：
    - 表单字段的标签。
    - 正确的 **ARIA** 角色和属性。
    - 足够的色彩对比度。
    - 媒体元素的替代文本（`alt`, `aria-label`）。
    - 语义化HTML以确保清晰的结构。
    - 使用诸如 **Lighthouse** 之类的工具进行审核。

## 浏览器兼容性

    - 优先考虑特性检测（`if ('fetch' in window)` 等）。
        - 支持主要浏览器的最新两个稳定版本：
    - Firefox、Chrome、Edge、Safari（macOS/iOS）
        - 必要时，强调使用 polyfills 或 bundlers（例如，**Babel**、**Vite**）进行渐进增强。

## PHP 要求

    - **目标版本**: PHP 8.1 或更高版本
    - **要使用的特性**:
    - 具名参数
    - 构造函数属性提升
    - 联合类型和可空类型
    - 匹配表达式
    - 空安全运算符 (`?->`)
    - 属性代替注释
    - 带有适当类型声明的类型化属性
    - 返回类型声明
    - 枚举 (`enum`)
    - 只读属性
    - 强调在所有生成的代码中使用严格的属性类型。
    - **编码标准**:
    - 遵循 PSR-12 编码标准
    - 使用严格类型化，使用 `declare(strict_types=1);`
    - 优先使用组合而不是继承
    - 使用依赖注入
    - **静态分析**:
    - 包含与 PHPStan 或 Psalm 兼容的 PHPDoc 块，用于静态分析
    - **错误处理**:
    - 一致地使用异常进行错误处理，并避免抑制错误。
    - 提供有意义的、清晰的异常消息和正确的异常类型。

## HTML/CSS 要求

    - **HTML**:
    - 使用 HTML5 语义元素（`<header>`, `<nav>`, `<main>`, `<section>`, `<article>`, `<footer>`, `<search>`, 等）
    - 包含适当的 ARIA 属性以实现可访问性
    - 确保有效的标记，通过 W3C 验证
    - 使用响应式设计实践
    - 使用现代格式优化图像（`WebP`, `AVIF`）
    - 在适用的图像上包含 `loading="lazy"`
    - 为响应式图像生成 `srcset` 和 `sizes` 属性（如果相关）
    - 优先考虑 SEO 友好的元素（`<title>`, `<meta description>`, Open Graph 标签）

    - **CSS**:
    - 使用现代 CSS 功能，包括：
    - 用于布局的 CSS Grid 和 Flexbox
    - CSS 自定义属性（变量）
    - CSS 动画和过渡
    - 用于响应式设计的媒体查询
    - 逻辑属性（`margin-inline`, `padding-block`, 等）
    - 现代选择器（`:is()`, `:where()`, `:has()`）
    - 遵循 BEM 或类似的方法进行类命名
    - 在适当的情况下使用 CSS 嵌套
    - 包含使用 `prefers-color-scheme`的暗模式支持
    - 优先使用现代、高性能的字体和可变字体，以减小文件大小
    - 使用现代单位（`rem`, `vh`, `vw`）代替传统的像素（`px`），以获得更好的响应能力

## JavaScript 要求

    - **最低兼容性**: ECMAScript 2020 (ES11) 或更高版本
    - **要使用的特性**:
    - 箭头函数
    - 模板字面量
    - 解构赋值
    - 展开/剩余运算符
    - 用于异步代码的 Async/Await
    - 当需要 OOP 时，使用适当继承的类
    - 对象简写表示法
    - 可选链操作符 (`?.`)
    - 空值合并运算符 (`??`)
    - 动态导入
    - 用于大型整数的 BigInt
    - `Promise.allSettled()`
    - `String.prototype.matchAll()`
    - `globalThis` 对象
    - 私有类字段和方法
    - Export * 作为命名空间语法
    - 数组方法（`map`, `filter`, `reduce`, `flatMap`, 等）
    - **避免**:
    - `var` 关键字（使用 `const` 和 `let`）
    - jQuery 或任何外部库
    - 当可以使用 Promise 时，避免基于回调的异步模式
    - Internet Explorer 兼容性
    - 旧版模块格式（使用 ES 模块）
    - 由于安全风险，限制使用 `eval()`
    - **性能注意事项**:
    - 建议代码分割和动态导入以进行延迟加载
    **错误处理**:
    - 对于异步和 API 调用，**始终** 使用 `try-catch` 块，并显式处理 Promise 拒绝。
    - 区分：
    - **网络错误**（例如，超时、服务器错误、速率限制）
    - **功能/业务逻辑错误**（逻辑错误、无效用户输入、验证失败）
    - **运行时异常**（意外错误，例如空引用）
    - 提供**用户友好的**错误消息（例如，“出现错误。请稍后再试。”）并将更多技术细节记录到开发/运维（例如，通过日志服务）。
    - 考虑使用中央错误处理函数或全局事件（例如， `window.addEventListener('unhandledrejection')`）来整合报告。
    - 仔细处理和验证 JSON 响应、不正确的 HTTP 状态代码等。

## 文件夹结构

    遵循此结构化目录布局：

    	项目根目录/
    	├── api/                  # API 处理程序和路由
    	├── config/               # 配置文件和环境变量
    	├── data/                 # 数据库、JSON 文件和其他存储
    	├── public/               # 公开可访问的文件（由 Web 服务器提供服务）
    	│   ├── assets/
    	│   │   ├── css/
    	│   │   ├── js/
    	│   │   ├── images/
    	│   │   ├── fonts/
    	│   └── index.html
    	├── src/                  # 应用程序源代码
    	│   ├── controllers/
    	│   ├── models/
    	│   ├── views/
    	│   └── utilities/
    	├── tests/                # 单元和集成测试
    	├── docs/                 # 文档（Markdown 文件）
    	├── logs/                 # 服务器和应用程序日志
    	├── scripts/              # 用于部署、设置等的脚本
    	└── temp/                 # 临时/缓存文件

## 文档要求

    - 为 JavaScript/TypeScript 包含 JSDoc 注释。
    - 使用清晰的示例记录复杂的函数。
    - 保持简洁的 Markdown 文档。
    - 最低文档块信息： `param`, `return`, `throws`, `author`

## 数据库要求 (SQLite 3.46+)

    - 利用 JSON 列、生成的列、严格模式、外键、检查约束和事务。

## 安全注意事项

    - 彻底清理所有用户输入。
    - 参数化数据库查询。
    - 实施严格的内容安全策略 (CSP)。
    - 在适用情况下使用 CSRF 保护。
    - 确保安全 Cookie（`HttpOnly`, `Secure`, `SameSite=Strict`）。
    - 限制权限并实施基于角色的访问控制。
    - 实施详细的内部日志记录和监控。
