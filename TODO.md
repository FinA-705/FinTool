你将帮我开发一个大型的 Python 选股项目，包含跨市场（A股、美股、港股）、多数据源、施洛斯价值投资策略、多评分机制（基础和AI）、回测、风险控制、自定义公式、自动调优等功能。
请根据我给出的分阶段任务，逐步生成对应模块代码骨架，代码文件不超过300行，职责清晰，模块化设计。

---

## 阶段 1：项目基础结构与环境 ✅ 已完成

任务描述：
- ✅ 初始化项目目录结构和基础文件
- ✅ 配置 requirements.txt 和代码规范工具
- ✅ 编写项目README和基础配置文件

**完成状态**: 项目基础目录结构已建立，requirements.txt已配置，README.md已创建。

---

## 阶段 2：数据源适配模块 ✅ 已完成

任务描述：
- ✅ 实现 adapters/base.py 作为数据适配器接口基类
- ✅ 实现一个示范数据源适配器 tushare_adapter.py
- ✅ 支持异步或多线程请求
- ✅ 实现字段映射机制 FIELD_MAP

**完成状态**: 适配器模块已完成，包含base.py、tushare_adapter.py、yfinance_adapter.py和factory.py。

---

## 阶段 3：数据清洗与标准化 ✅ 已完成

任务描述：
- ✅ 编写 cleaner/cleaner.py，完成字段重命名、单位转换、缺失值处理
- ✅ 支持按市场和板块过滤
- ✅ 统一输出 Pandas DataFrame 格式

**完成状态**: 数据清洗模块已完成，包含完整的清洗、验证、映射和过滤功能。

---

## 阶段 4：施洛斯核心策略模块 ✅ 已完成

任务描述：
- ✅ 编写 strategies/schloss_strategy.py，实现 Walter Schloss 核心选股条件
- ✅ 支持外部配置动态加载策略参数
- ✅ 预留策略插件扩展接口

**完成状态**: 施洛斯策略已实现，包含完整的策略引擎和扩展机制。

---

## 阶段 5：评分模块 ✅ 已完成

任务描述：
- ✅ 编写 scorer/basic_scorer.py，完成基础评分功能
- ✅ 编写 scorer/ai_scorer.py，集成 AI 模型（如 GPT-4）接口，输出结构化 JSON 评分和理由
- ✅ 编写 scorer/risk_assessor.py，计算波动率、最大回撤等风险指标

**完成状态**: 评分模块已完成，包含基础评分、AI评分和风险评估功能。

---

## 阶段 6：配置与缓存模块 ✅ 已完成 🔧 已重构优化

任务描述：
- ✅ 编写 core/config_manager.py，支持 YAML/JSON 配置热加载
- ✅ 编写 core/cache_manager.py，实现 SQLite 和本地文件缓存
- ✅ 编写 core/output_formatter.py，生成标准 JSON 输出格式
- ✅ 编写 core/scheduler.py，实现定时任务调度

**完成状态**: 配置与缓存模块已完成。配置管理器已重构优化，实现了统一的配置管理架构。

---

## 阶段 7：公共工具库 utils/ ✅ 已完成 🔧 已重构优化

任务描述：
- ✅ 编写 utils/logger.py，基于 loguru 实现统一日志接口
- ✅ 编写 utils/timer.py，实现性能计时工具
- ✅ 编写 utils/validators.py，实现数据验证函数
- ✅ 编写 utils/json_helper.py，方便 JSON 读写
- ✅ 编写 utils/df_helper.py，封装常用 Pandas 操作
- ✅ 编写 utils/api_helper.py，实现 API 请求和重试
- ✅ 编写 utils/cache_helper.py，封装缓存相关逻辑
- ✅ 编写 utils/expression_evaluator.py，支持策略表达式动态执行

**完成状态**: 公共工具库已完成。所有helper文件已重构优化，消除了通配符导入，提高了代码质量。

---

## 阶段 8：用户自定义策略表达式支持 ✅ 已完成

任务描述：
- ✅ 编写 strategies/formula_parser.py，实现策略表达式解析和校验
- ✅ 集成 utils/expression_evaluator.py 支持动态执行用户自定义策略

**完成状态**: 策略表达式支持已完成，包含完整的解析和执行功能。

---

## 阶段 9：回测模块 ✅ 已完成

任务描述：
- ✅ 编写 backtest/backtester.py，实现历史数据回测引擎
- ✅ 编写 backtest/performance_metrics.py，实现回测绩效指标计算
- ✅ 支持多市场多策略回测对比

**完成状态**: 回测模块已完成，包含完整的回测引擎和绩效分析功能。

---

## 阶段 10：CLI 和 Web 交互层 ✅ 已完成 🔧 已重构优化

任务描述：
- ✅ 实现 cli.py 命令行入口，支持配置覆盖、JSON 输出、美化打印
- ✅ 搭建 webapp/app.py，搭建基础 Web 服务（Flask/FastAPI）
- ✅ 编写 webapp/routes/stock_routes.py 和 config_routes.py，实现数据接口和配置管理接口
- ✅ 设计 Web 前端组件（表格、热力图、分布图、AI解释卡片）
- ✅ 实现配置动态修改和实时生效功能

**完成状态**: CLI和Web交互层已完成。路由结构已重构优化，简化了复杂度，提高了可维护性。

---

## 阶段 11：AI集成模块增强 🚧 进行中

任务描述：
- 增强 AI 评分模块的分析深度和准确性
- 实现 AI 投资建议生成
- 集成更多 AI 模型（Claude、Bard等）进行对比分析
- 实现 AI 辅助策略优化

**当前状态**: 基础AI模块已实现，需要进一步增强和扩展。

---

## 阶段 12：高级功能与自动化 🚧 计划中

任务描述：
- 实现自动化回测报告生成
- 增强风险管理功能
- 实现投资组合优化算法
- 添加更多技术指标和基本面分析
- 实现自动化数据更新和监控

**当前状态**: 基础回测功能已实现，需要添加高级功能。

---

## 🔧 重构优化阶段（当前完成的工作）

### 已完成的重构工作：

1. **配置管理统一化** ✅
   - 消除了 `strategies/config_manager.py` 的代码重复
   - 实现了基于 `core.config_manager` 的委托模式
   - 保持了策略专用配置功能的同时减少了维护成本

2. **路由结构简化** ✅
   - 将 `webapp/routes/stock/` 子目录的5个文件合并为单个 `stock_routes.py`
   - 路由层级从3层减少到2层
   - 提高了代码可维护性和导航便利性

3. **工具模块导入优化** ✅
   - 更新了所有 `utils/*_helper.py` 文件
   - 将通配符导入替换为显式导入
   - 提高了代码分析能力和IDE支持

4. **项目清理** ✅
   - 添加了 `.gitignore` 文件
   - 删除了冗余文件和空目录
   - 优化了项目结构

### 重构统计：
- 📁 删除文件：7个
- 🔧 重构文件：6个
- 📝 新建文件：2个
- 📊 代码行数减少：约200行
- 🏗️ 架构改进：消除了循环依赖，提高了模块内聚性

---

## 📋 待验证事项

1. **功能完整性验证** 🔍
   - 验证所有API端点正常工作
   - 测试策略执行功能
   - 检查配置加载功能

2. **性能测试** 🔍
   - 测试数据获取性能
   - 验证缓存功能
   - 检查内存使用情况

3. **集成测试** 🔍
   - 测试完整的策略执行流程
   - 验证Web界面功能
   - 检查CLI命令执行

---

## 🎯 下一步计划

1. **立即执行**: 运行完整的功能测试以验证重构后的代码稳定性
2. **短期目标**: 完成阶段11的AI功能增强
3. **中期目标**: 实现阶段12的高级功能
4. **长期目标**: 项目产品化和部署优化

---

## 📈 项目进度总览

- **核心功能**: ✅ 100% 完成
- **基础架构**: ✅ 100% 完成
- **代码质量**: ✅ 95% 完成（重构优化完成）
- **高级功能**: 🚧 20% 完成
- **测试覆盖**: 🔍 需要验证
- **文档完善**: 📝 80% 完成

---

## 开发规范说明

- 所有模块职责清晰，单一功能
- 单文件不超过 300 行，如超过需拆分子模块
- 模块间通过接口解耦
- AI 评分输出必须是结构化 JSON，包含评分、推荐、理由、标签等字段

---

请先执行阶段 1 的任务，生成项目基础目录结构和 requirements.txt，确认后再继续阶段 2。
完成某个阶段后，在该文件进行标记。
