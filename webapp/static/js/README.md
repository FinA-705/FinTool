# 前端模块化结构说明

## 概述

原来的 `main.js` 文件（1500+ 行）已经被拆分成多个模块，以提高代码的可维护性和可读性。

## 模块结构

```
webapp/static/js/
├── main.js                 # 模块加载器（新）
├── main-backup.js          # 原始文件备份
└── modules/
    ├── config.js           # 配置和常量
    ├── utils.js            # 工具函数库
    ├── api.js              # API 请求处理
    ├── dashboard.js        # 仪表板功能
    ├── stocks.js           # 股票数据管理
    ├── strategies.js       # 策略管理
    ├── backtest.js         # 回测分析
    ├── config-manager.js   # 系统配置管理
    └── app.js              # 主应用控制器
```

## 模块详细说明

### 1. main.js
- **功能**: 模块加载器
- **职责**: 按正确顺序动态加载所有功能模块
- **优势**: 自动化模块加载，确保依赖关系正确

### 2. modules/config.js
- **功能**: 全局配置和状态管理
- **包含**:
  - API_BASE 配置
  - CONFIG 对象（图表颜色、刷新间隔等）
  - STATE 对象（当前标签页、数据缓存等）

### 3. modules/utils.js
- **功能**: 通用工具函数
- **包含**:
  - 数字格式化函数
  - 通知显示函数
  - 防抖和节流函数

### 4. modules/api.js
- **功能**: API 请求封装
- **包含**:
  - 统一的请求处理
  - GET/POST/PUT/DELETE 方法
  - 错误处理和重试机制

### 5. modules/dashboard.js
- **功能**: 仪表板页面管理
- **包含**:
  - 统计数据加载
  - 图表绘制
  - 快速操作处理

### 6. modules/stocks.js
- **功能**: 股票数据管理
- **包含**:
  - 数据表格初始化
  - 股票数据刷新
  - 数据导出功能
  - 股票详情显示

### 7. modules/strategies.js
- **功能**: 策略管理
- **包含**:
  - 策略列表管理
  - 策略执行逻辑
  - 结果展示
  - 策略 CRUD 操作

### 8. modules/backtest.js
- **功能**: 回测分析
- **包含**:
  - 回测配置管理
  - 回测执行逻辑
  - 结果可视化
  - 历史记录管理

### 9. modules/config-manager.js
- **功能**: 系统配置管理
- **包含**:
  - 系统信息显示
  - 缓存管理
  - 配置重置
  - 数据导出

### 10. modules/app.js
- **功能**: 主应用控制器
- **包含**:
  - 应用初始化
  - 事件绑定
  - 标签页切换
  - 全局函数暴露

## 加载顺序

模块按以下顺序加载，确保依赖关系正确：

1. **config.js** - 提供全局配置
2. **utils.js** - 提供工具函数
3. **api.js** - 提供 API 服务
4. **dashboard.js** - 仪表板功能
5. **stocks.js** - 股票数据功能
6. **strategies.js** - 策略管理功能
7. **backtest.js** - 回测分析功能
8. **config-manager.js** - 配置管理功能
9. **app.js** - 主控制器（最后加载，负责初始化）

## 优势

1. **可维护性**: 每个模块职责单一，易于维护
2. **可扩展性**: 新功能可以轻松添加新模块
3. **可测试性**: 各模块可以独立测试
4. **代码复用**: 通用功能（如 Utils、ApiService）可以被多个模块使用
5. **性能优化**: 按需加载，提高页面加载速度

## 注意事项

1. **依赖关系**: 确保模块加载顺序正确
2. **全局暴露**: 需要在 HTML 中使用的函数必须暴露到 window 对象
3. **向后兼容**: 保持原有 API 不变，确保 HTML 模板无需修改

## 未来改进

1. 可以考虑使用 ES6 模块或现代构建工具
2. 添加模块单元测试
3. 实现模块懒加载以进一步优化性能
